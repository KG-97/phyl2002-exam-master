<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="PHYL2002 Ultimate Study Suite: cram mode, exam simulator, flashcards, glossary, calculators, and physiology simulators." />
    <title>PHYL2002 Ultimate Study Suite v2.2</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- React Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#151e2e', 900: '#0f172a', 950: '#020617' },
                        sci: {
                            cyan: '#06b6d4',
                            purple: '#8b5cf6',
                            rose: '#f43f5e',
                            amber: '#f59e0b',
                            emerald: '#10b981',
                            blue: '#3b82f6',
                            teal: '#14b8a6'
                        }
                    },
                    animation: {
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'flip': 'flip 0.6s preserve-3d'
                    },
                    keyframes: {
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a; 
            color: #f1f5f9;
            background-image: 
                radial-gradient(at 0% 0%, rgba(16, 185, 129, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(139, 92, 246, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .glass-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.5), rgba(15, 23, 42, 0.7));
            border: 1px solid rgba(148, 163, 184, 0.08);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .glass-card:hover {
            border-color: rgba(6, 182, 212, 0.4);
            transform: translateY(-4px);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
        }

        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }

        :focus-visible {
            outline: 2px solid #06b6d4;
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body>
    <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:bg-slate-900 focus:text-white focus:px-4 focus:py-2 focus:rounded-lg">Skip to main content</a>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ==========================================
        // 1. DATA WAREHOUSE
        // ==========================================

        const TERMINOLOGY = [
            { term: "RMP", def: "Resting Membrane Potential. Voltage difference across membrane at rest (~-70mV)." },
            { term: "AP", def: "Action Potential. Rapid, transient change in membrane potential used for signalling." },
            { term: "EPSP", def: "Excitatory Post-Synaptic Potential. Depolarizing graded potential." },
            { term: "IPSP", def: "Inhibitory Post-Synaptic Potential. Hyperpolarizing graded potential." },
            { term: "TTX", def: "Tetrodotoxin. Pufferfish toxin. Blocks Voltage-Gated Na+ Channels." },
            { term: "TEA", def: "Tetraethylammonium. Blocks Voltage-Gated K+ Channels." },
            { term: "DHPR", def: "Dihydropyridine Receptor. Voltage sensor in T-tubules (Skeletal/Cardiac)." },
            { term: "RyR", def: "Ryanodine Receptor. Ca2+ release channel on Sarcoplasmic Reticulum." },
            { term: "SERCA", def: "Sarcoplasmic Endoplasmic Reticulum Calcium ATPase. Pumps Ca2+ back into SR." },
            { term: "CICR", def: "Calcium-Induced Calcium Release. Mechanism in Cardiac muscle." },
            { term: "MLCK", def: "Myosin Light Chain Kinase. Enzyme in Smooth Muscle that phosphorylates myosin to trigger contraction." },
            { term: "MLCP", def: "Myosin Light Chain Phosphatase. Enzyme in Smooth Muscle that dephosphorylates myosin to cause relaxation." },
            { term: "SGLT", def: "Sodium-Glucose Linked Transporter. Secondary active transport (Symport)." },
            { term: "GLUT", def: "Glucose Transporter. Facilitated diffusion carrier." },
            { term: "GPCR", def: "G-Protein Coupled Receptor. 7-transmembrane domain receptor family." },
            { term: "cAMP", def: "Cyclic Adenosine Monophosphate. Second messenger activated by Adenylyl Cyclase (Gs)." },
            { term: "IP3", def: "Inositol Triphosphate. Second messenger (Gq path) that releases Ca2+ from ER/SR." },
            { term: "DAG", def: "Diacylglycerol. Second messenger (Gq path) that activates PKC." },
            { term: "PKA", def: "Protein Kinase A. Activated by cAMP." },
            { term: "PKC", def: "Protein Kinase C. Activated by DAG + Ca2+." },
            { term: "SEM", def: "Standard Error of the Mean. SD divided by square root of n." },
            { term: "ANS", def: "Autonomic Nervous System. Sympathetic and Parasympathetic divisions." }
        ];

        const FLASHCARDS = [
            // Stats
            { id: 'f1', cat: 'Stats', q: "SEM vs SD?", a: "SD measures data spread. SEM measures precision of the mean estimate. Error bars usually use SEM." },
            { id: 'f2', cat: 'Stats', q: "Paired t-test use?", a: "Comparing means from the SAME subject group (e.g., Before vs After). Data is correlated." },
            { id: 'f3', cat: 'Stats', q: "Type 1 vs Type 2 Error?", a: "Type 1 (Alpha): False Positive. Type 2 (Beta): False Negative." },
            // Nerves
            { id: 'f4', cat: 'Nerves', q: "Goldman Equation?", a: "Calculates RMP based on Permeability (P) of K, Na, Cl. At rest P_K is high, so Vm is near E_K." },
            { id: 'f5', cat: 'Nerves', q: "Absolute Refractory Period?", a: "Caused by Na+ channel INACTIVATION. Cannot fire AP regardless of stimulus." },
            { id: 'f6', cat: 'Nerves', q: "Saltatory Conduction?", a: "APs jump Nodes of Ranvier in myelinated axons. Myelin increases resistance & decreases capacitance." },
            { id: 'f7', cat: 'Nerves', q: "Hyperkalemia effect?", a: "High external K+ makes E_K less negative -> Depolarizes RMP -> Increases excitability." },
            { id: 'f8', cat: 'Nerves', q: "Spatial vs Temporal Summation?", a: "Spatial: Multiple synapses firing at once. Temporal: One synapse firing rapidly." },
            // Muscle
            { id: 'f9', cat: 'Muscle', q: "Skeletal EC Coupling?", a: "Mechanical. DHPR (T-tubule) physically pulls RyR (SR) open. Ca2+ is internal only." },
            { id: 'f10', cat: 'Muscle', q: "Cardiac EC Coupling?", a: "CICR. L-type Ca2+ entry triggers RyR on SR. Ca2+ is Ext + Int." },
            { id: 'f11', cat: 'Muscle', q: "Smooth Muscle Sensor?", a: "Calmodulin (No Troponin). Activates MLCK to phosphorylate myosin." },
            { id: 'f12', cat: 'Muscle', q: "Latch State?", a: "Smooth muscle ability to maintain force with low ATP use." },
            { id: 'f13', cat: 'Muscle', q: "Cardiac AP Phase 2?", a: "Plateau Phase. L-type Ca2+ influx balances K+ efflux." },
            { id: 'f14', cat: 'Muscle', q: "Role of Titin?", a: "Molecular spring. Centers thick filament and provides passive tension." },
            // Sensory
            { id: 'f15', cat: 'Sensory', q: "Dark Current?", a: "In dark, high cGMP keeps Na+/Ca2+ channels OPEN. Photoreceptor is depolarized." },
            { id: 'f16', cat: 'Sensory', q: "Lateral Inhibition?", a: "Inhibiting neighbors to sharpen contrast and spatial acuity." },
            { id: 'f17', cat: 'Sensory', q: "Labeled Line?", a: "The nerve fiber stimulated determines the sensation type, not the stimulus." },
            { id: 'f18', cat: 'Sensory', q: "Salt Taste Mechanism?", a: "Na+ enters via ENaC channels -> Depolarization." },
            { id: 'f19', cat: 'Sensory', q: "Sour Taste Mechanism?", a: "H+ blocks K+ channels or enters cell -> Depolarization." },
            // Transport
            { id: 'f20', cat: 'Transport', q: "Na/K Pump Ratio?", a: "3 Na+ OUT, 2 K+ IN. Uses 1 ATP. Electrogenic." },
            { id: 'f21', cat: 'Transport', q: "SGLT1?", a: "Secondary Active. Uses Na+ gradient to move Glucose uphill." },
            { id: 'f22', cat: 'Transport', q: "Tonicity?", a: "Depends on NON-PENETRATING solutes. Determines cell volume." },
            // ANS
            { id: 'f23', cat: 'ANS', q: "Gs Pathway?", a: "Receptor -> Gs -> Adenylyl Cyclase -> cAMP -> PKA." },
            { id: 'f24', cat: 'ANS', q: "Gq Pathway?", a: "Receptor -> Gq -> PLC -> IP3 (Ca2+) + DAG (PKC)." },
            { id: 'f25', cat: 'ANS', q: "Beta-1 Receptor?", a: "Gs coupled. Heart. Increases HR and Contractility." },
            { id: 'f26', cat: 'ANS', q: "Alpha-2 Receptor?", a: "Gi coupled. Presynaptic inhibition (Decreases NE release)." }
        ];

        const CRAM_FACTS_LIST = [
            // STATS
            { topic: "Stats", text: "SEM = SD / √n. Measures precision of the mean." },
            { topic: "Stats", text: "Unpaired t-test: Used for two INDEPENDENT groups (e.g., Toads vs Mice)." },
            { topic: "Stats", text: "Paired t-test: Used for SAME subjects measured twice (e.g., Pre/Post)." },
            { topic: "Stats", text: "Type 1 Error (Alpha): False Positive. Rejecting Null when true." },
            // NERVES
            { topic: "Nerves", text: "Goldman Eq: Uses Permeability (P). P_K dominates at rest." },
            { topic: "Nerves", text: "Abs. Refractory: Na+ channels are INACTIVATED (Ball & Chain)." },
            { topic: "Nerves", text: "Rel. Refractory: K+ channels open + membrane hyperpolarized." },
            { topic: "Nerves", text: "TTX (Pufferfish): Blocks Voltage-gated Na+ channels (No AP)." },
            { topic: "Nerves", text: "TEA: Blocks Voltage-gated K+ channels (Delayed repolarization)." },
            { topic: "Nerves", text: "Saltatory: AP jumps Nodes of Ranvier. Myelin ↓Capacitance ↑Resistance." },
            { topic: "Nerves", text: "Space Constant (λ): Distance where Vm decays to 37%." },
            { topic: "Nerves", text: "Electrical Synapse: Gap Junctions (Connexons). Bidirectional. Fast." },
            { topic: "Nerves", text: "Botulinum Toxin: Cleaves SNAREs. Prevents ACh release. Flaccid Paralysis." },
            // MUSCLE
            { topic: "Muscle", text: "Skeletal Ca2+: Internal Only (SR). Mechanical coupling (DHPR-RyR)." },
            { topic: "Muscle", text: "Cardiac Ca2+: Ext (L-type) + Int (SR). CICR." },
            { topic: "Muscle", text: "Smooth Ca2+: Calmodulin (No Troponin). Phosphorylates Myosin." },
            { topic: "Muscle", text: "Latch State: Smooth muscle maintains force with low ATP." },
            { topic: "Muscle", text: "Frank-Starling: ↑ Venous Return = ↑ Stretch = ↑ Stroke Volume." },
            { topic: "Muscle", text: "Tetanus: Impossible in Cardiac (Long Refractory Period)." },
            { topic: "Muscle", text: "Rigor Mortis: No ATP to detach myosin head from actin." },
            { topic: "Muscle", text: "Type I Fibers: Slow Oxidative. Red (Myoglobin). Fatigue Resistant." },
            { topic: "Muscle", text: "A-Band: Length of Thick filaments. Constant length." },
            // SENSORY
            { topic: "Sensory", text: "Dark Current: cGMP high -> Na+/Ca2+ channels OPEN -> Depolarized." },
            { topic: "Sensory", text: "Light: Rhodopsin -> Transducin -> PDE -> ↓cGMP -> Hyperpolarization." },
            { topic: "Sensory", text: "Fovea: Cones only. 1:1 convergence. High acuity." },
            { topic: "Sensory", text: "Cochlea Base: Narrow/Stiff. High Frequency." },
            { topic: "Sensory", text: "Cochlea Apex: Wide/Floppy. Low Frequency." },
            { topic: "Sensory", text: "Outer Hair Cells: Cochlear Amplifier (Electromotility)." },
            { topic: "Sensory", text: "Utricle/Saccule: Linear Acceleration & Head Tilt (Gravity)." },
            { topic: "Sensory", text: "Semicircular Canals: Angular (Rotational) Acceleration." },
            { topic: "Sensory", text: "Phasic Receptors: Rapidly adapting (Smell, Touch/Vibration)." },
            { topic: "Sensory", text: "Lateral Inhibition: Enhances contrast/acuity by inhibiting neighbors." },
            { topic: "Sensory", text: "Sweet/Umami/Bitter: GPCRs (T1R/T2R families)." },
            // TRANSPORT
            { topic: "Transport", text: "Na/K Pump: 3 Na+ OUT, 2 K+ IN. Uses 1 ATP. Electrogenic." },
            { topic: "Transport", text: "SGLT1: Secondary Active. Na+ gradient pulls Glucose in." },
            { topic: "Transport", text: "GLUT: Facilitated Diffusion (Passive)." },
            { topic: "Transport", text: "Tonicity: Depends on NON-PENETRATING solutes only." },
            { topic: "Transport", text: "Fick's Law: Rate = D * A * (dC/dx)." },
            // SIGNALLING
            { topic: "Signal", text: "Gs: Adenylyl Cyclase -> ↑cAMP -> PKA." },
            { topic: "Signal", text: "Gq: PLC -> IP3 (Ca2+) + DAG (PKC)." },
            { topic: "Signal", text: "Beta-1: Gs coupled. Heart (↑HR, ↑Contractility)." },
            { topic: "Signal", text: "Alpha-1: Gq coupled. Vessels (Vasoconstriction)." },
            { topic: "Signal", text: "Muscarinic M2: Gi. Heart (↓HR)." },
            { topic: "Signal", text: "Nicotinic: Skeletal Muscle (Ion Channel)." }
        ];

        const EXAM_QUESTIONS = [
            { id: 1, q: "You measure conduction velocity in 8 cane toads vs 6 mice. Which statistical test?", options: ["Paired t-test", "Unpaired t-test", "Correlation", "Chi-square"], a: 1, expl: "Two different independent groups with different N values requires an Unpaired t-test." },
            { id: 2, q: "What does SEM (Standard Error of Mean) represent?", options: ["Spread of data", "Precision of the mean estimate", "Significance level", "Median value"], a: 1, expl: "SEM = SD/sqrt(n). It indicates how confident we are in the mean." },
            { id: 3, q: "Tetrodotoxin (TTX) blocks which channel?", options: ["Voltage-gated K+", "Voltage-gated Na+", "Ligand-gated Cl-", "Ca2+ Leak"], a: 1, expl: "TTX binds to the pore of Nav channels, preventing the AP upstroke." },
            { id: 4, q: "If P_Na increases significantly, Vm approaches:", options: ["E_K (-90mV)", "E_Cl (-70mV)", "E_Na (+60mV)", "0 mV"], a: 2, expl: "Goldman Eq: Vm moves toward the equilibrium potential of the most permeable ion." },
            { id: 5, q: "Phase 0 of the Cardiac Ventricular AP is due to:", options: ["Ca2+ influx", "K+ efflux", "Na+ influx", "Cl- influx"], a: 2, expl: "Fast response cardiac cells (muscle) depolarize via fast Voltage-gated Na+ channels." },
            { id: 6, q: "In skeletal muscle, Ca2+ is released from:", options: ["ECF only", "SR only", "Mitochondria", "Nucleus"], a: 1, expl: "Skeletal muscle uses internal Ca2+ stores from the SR via mechanical DHPR-RyR coupling." },
            { id: 7, q: "Which feature prevents cardiac tetanus?", options: ["Lack of Troponin", "Long refractory period", "Fast Ca2+ reuptake", "Short AP"], a: 1, expl: "Cardiac AP is long (plateau). The refractory period lasts almost as long as the twitch, preventing summation." },
            { id: 8, q: "Smooth muscle relaxation requires:", options: ["Troponin C", "Myosin Light Chain Phosphatase", "Actin degradation", "Na+ influx"], a: 1, expl: "MLCP removes phosphate from myosin light chains, stopping crossbridge cycling." },
            { id: 9, q: "In the Ussing chamber, replacing Cl- with Sulphate increases voltage because:", options: ["Sulphate is non-penetrating", "Sulphate pumps faster", "Pump rate increased", "Resistance decreased"], a: 0, expl: "Sulphate is large/divalent and cannot follow Na+ across the membrane like Cl-. Charge separation increases -> higher voltage." },
            { id: 10, q: "A 300 mM Urea solution is:", options: ["Isotonic", "Hypertonic", "Hypotonic", "Iso-osmotic but Hypotonic"], a: 3, expl: "300 mM is Iso-osmotic. But Urea penetrates cells. Water follows urea into the cell -> Swelling -> Hypotonic." },
            { id: 11, q: "In the dark, photoreceptors are:", options: ["Hyperpolarized", "Depolarized", "Inactive", "Repolarizing"], a: 1, expl: "Dark Current: cGMP-gated channels are open, Na+/Ca2+ influx keeps Vm ~ -40mV (Depolarized)." },
            { id: 12, q: "The Otolith organs (Utricle/Saccule) detect:", options: ["Angular acceleration", "Linear acceleration & Head tilt", "Sound frequency", "Temperature"], a: 1, expl: "Heavy crystals (otoliths) drag hair cells during linear movement or gravity changes." },
            { id: 13, q: "Activation of Gq-coupled receptors leads to:", options: ["Increased cAMP", "Decreased cAMP", "Increased IP3 and Ca2+", "Opening of Cl- channels"], a: 2, expl: "Gq activates PLC -> Cleaves PIP2 into IP3 + DAG. IP3 releases Ca2+." },
            { id: 14, q: "Stimulation of Beta-1 receptors causes:", options: ["Bronchoconstriction", "Increased Heart Rate", "Vasoconstriction", "Salivation"], a: 1, expl: "Beta-1 (Gs) are cardiac. Increase cAMP -> Increase HR and Contractility." }
        ];

        // --- ICONS COMPONENT ---
        const Icon = ({ name, size = 20, className }) => {
            useEffect(() => { lucide.createIcons(); }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // ==========================================
        // 2. VIEW COMPONENTS
        // ==========================================

        // --- DASHBOARD ---
        const Dashboard = ({ setView, stats, onReset }) => (
            <div className="max-w-6xl mx-auto px-4 py-8 animate-slide-up space-y-8">
                <div className="text-center py-6">
                    <h1 className="text-5xl md:text-6xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-sci-cyan via-sci-blue to-sci-purple mb-3">
                        PHYL2002 PRO
                    </h1>
                    <p className="text-slate-400 text-lg font-light tracking-wide">Ultimate Revision Suite v2.2</p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                    <button onClick={() => setView('cram')} className="group glass-card p-6 rounded-2xl hover:border-sci-emerald text-left transition-all relative overflow-hidden">
                        <div className="absolute -right-6 -top-6 opacity-10 text-sci-emerald"><Icon name="zap" size={140} /></div>
                        <div className="relative z-10">
                            <div className="flex items-center gap-3 mb-3">
                                <div className="p-2 bg-sci-emerald/20 rounded-lg text-sci-emerald"><Icon name="zap" size={24} /></div>
                                <h3 className="text-xl font-bold text-white">Cram Mode</h3>
                            </div>
                            <p className="text-sm text-slate-300">100+ Rapid-fire facts.</p>
                        </div>
                    </button>

                    <button onClick={() => setView('exam')} className="group glass-card p-6 rounded-2xl hover:border-sci-rose text-left transition-all">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="p-2 bg-sci-rose/20 rounded-lg text-sci-rose"><Icon name="file-question" size={24} /></div>
                            <h3 className="text-xl font-bold text-white">Exam Simulator</h3>
                        </div>
                        <p className="text-sm text-slate-300">Randomized MCQs with logic explanations.</p>
                    </button>

                    <button onClick={() => setView('flashcards')} className="group glass-card p-6 rounded-2xl hover:border-sci-cyan text-left transition-all">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="p-2 bg-sci-cyan/20 rounded-lg text-sci-cyan"><Icon name="layers" size={24} /></div>
                            <h3 className="text-xl font-bold text-white">Flashcards</h3>
                        </div>
                        <p className="text-sm text-slate-300">Active recall with Usage Tips.</p>
                    </button>

                    <button onClick={() => setView('terms')} className="group glass-card p-6 rounded-2xl hover:border-sci-teal text-left transition-all">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="p-2 bg-sci-teal/20 rounded-lg text-sci-teal"><Icon name="book-open" size={24} /></div>
                            <h3 className="text-xl font-bold text-white">Terminology</h3>
                        </div>
                        <p className="text-sm text-slate-300">Glossary of Acronyms & Terms.</p>
                    </button>

                    <button onClick={() => setView('muscle')} className="group glass-card p-6 rounded-2xl hover:border-sci-amber text-left transition-all">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="p-2 bg-sci-amber/20 rounded-lg text-sci-amber"><Icon name="activity" size={24} /></div>
                            <h3 className="text-xl font-bold text-white">Muscle Matrix</h3>
                        </div>
                        <p className="text-sm text-slate-300">Compare Skeletal, Cardiac & Smooth.</p>
                    </button>

                    <button onClick={() => setView('calc')} className="group glass-card p-6 rounded-2xl hover:border-sci-purple text-left transition-all">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="p-2 bg-sci-purple/20 rounded-lg text-sci-purple"><Icon name="calculator" size={24} /></div>
                            <h3 className="text-xl font-bold text-white">Calculators</h3>
                        </div>
                        <p className="text-sm text-slate-300">Nernst, GHK & Stats.</p>
                    </button>

                    <button onClick={() => setView('ghk')} className="group glass-card p-6 rounded-2xl hover:border-sci-blue text-left transition-all">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="p-2 bg-sci-blue/20 rounded-lg text-sci-blue"><Icon name="sliders" size={24} /></div>
                            <h3 className="text-xl font-bold text-white">GHK Simulator</h3>
                        </div>
                        <p className="text-sm text-slate-300">Model membrane potential with ion permeability.</p>
                    </button>

                    <button onClick={() => setView('ap')} className="group glass-card p-6 rounded-2xl hover:border-sci-rose text-left transition-all">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="p-2 bg-sci-rose/20 rounded-lg text-sci-rose"><Icon name="activity" size={24} /></div>
                            <h3 className="text-xl font-bold text-white">AP Explorer</h3>
                        </div>
                        <p className="text-sm text-slate-300">Step through action potential phases.</p>
                    </button>
                </div>

                <div className="glass-panel rounded-2xl p-6">
                    <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
                        <h3 className="text-sm uppercase tracking-widest text-slate-500 font-bold">Review Snapshot</h3>
                        <button onClick={onReset} className="text-xs uppercase tracking-widest text-slate-400 hover:text-white border border-slate-700 px-3 py-1 rounded-full w-fit">
                            Reset Progress
                        </button>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div className="bg-slate-900/40 p-4 rounded-xl border border-slate-800">
                            <div className="text-3xl font-bold text-white">{CRAM_FACTS_LIST.length}</div>
                            <div className="text-sm text-slate-500">Cram Facts</div>
                            <div className="text-xs text-slate-400 mt-2">Viewed: {stats.cramCount}</div>
                        </div>
                        <div className="bg-slate-900/40 p-4 rounded-xl border border-slate-800">
                            <div className="text-3xl font-bold text-white">{FLASHCARDS.length}</div>
                            <div className="text-sm text-slate-500">Flashcards</div>
                            <div className="text-xs text-slate-400 mt-2">Reviewed: {stats.cardsLearned}</div>
                        </div>
                        <div className="bg-slate-900/40 p-4 rounded-xl border border-slate-800">
                            <div className="text-3xl font-bold text-white">{TERMINOLOGY.length}</div>
                            <div className="text-sm text-slate-500">Glossary Terms</div>
                            <div className="text-xs text-slate-400 mt-2">Quick reference</div>
                        </div>
                        <div className="bg-slate-900/40 p-4 rounded-xl border border-slate-800">
                            <div className="text-3xl font-bold text-sci-emerald">{stats.quizScore}%</div>
                            <div className="text-sm text-slate-500">Best Exam Score</div>
                            <div className="text-xs text-slate-400 mt-2">Questions: {EXAM_QUESTIONS.length}</div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // 2. TERMINOLOGY / GLOSSARY
        const Glossary = ({ onBack }) => {
            const [search, setSearch] = useState('');
            
            const filtered = useMemo(() => 
                TERMINOLOGY.filter(t => 
                    t.term.toLowerCase().includes(search.toLowerCase()) || 
                    t.def.toLowerCase().includes(search.toLowerCase())
                ).sort((a,b) => a.term.localeCompare(b.term))
            , [search]);

            return (
                <div className="max-w-3xl mx-auto px-4 py-8 animate-slide-up h-screen flex flex-col">
                    <button onClick={onBack} className="mb-6 text-slate-400 hover:text-white flex gap-2 w-fit"><Icon name="arrow-left" /> Home</button>
                    
                    <div className="glass-panel rounded-2xl p-6 flex-1 flex flex-col overflow-hidden">
                        <div className="mb-6">
                            <h2 className="text-2xl font-bold text-white mb-4">Glossary of Terms</h2>
                            <div className="relative">
                                <Icon name="search" className="absolute left-3 top-3 text-slate-500" size={18} />
                                <input 
                                    type="text" 
                                    placeholder="Search acronyms or definitions..." 
                                    className="w-full bg-slate-900/50 border border-slate-700 rounded-lg pl-10 pr-4 py-3 text-white outline-none focus:border-sci-teal"
                                    value={search}
                                    onChange={e => setSearch(e.target.value)}
                                />
                            </div>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto space-y-3 pr-2">
                            {filtered.length === 0 ? (
                                <div className="text-center text-slate-500 mt-10">No terms found.</div>
                            ) : (
                                filtered.map((item, i) => (
                                    <div key={i} className="bg-slate-800/50 p-4 rounded-xl border border-slate-700/50 hover:border-sci-teal/30 transition">
                                        <div className="text-sci-teal font-bold text-lg mb-1">{item.term}</div>
                                        <div className="text-slate-300 text-sm leading-relaxed">{item.def}</div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // 3. CRAM MODE
        const CramMode = ({ onBack, updateStats }) => {
            const [idx, setIdx] = useState(0);
            const [shuffled, setShuffled] = useState([]);
            
            useEffect(() => {
                const arr = [...CRAM_FACTS_LIST];
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                setShuffled(arr);
            }, []);

            const next = () => {
                setIdx(prev => (prev + 1) % shuffled.length);
                updateStats('cram', 1);
            };

            if (shuffled.length === 0) return <div className="text-center p-10 text-sci-cyan">Loading Facts...</div>;

            const fact = shuffled[idx];

            return (
                <div className="max-w-2xl mx-auto px-4 h-screen flex flex-col justify-center animate-fade-in">
                    <button onClick={onBack} className="absolute top-6 left-6 text-slate-400 hover:text-white flex gap-2"><Icon name="arrow-left" /> Exit</button>
                    
                    <div className="glass-panel border-t-4 border-sci-emerald p-8 rounded-3xl relative overflow-hidden cursor-pointer group" onClick={next}>
                        <div className="absolute top-0 left-0 w-full h-1 bg-slate-800"><div className="h-full bg-sci-emerald transition-all duration-300" style={{ width: `${((idx + 1) / shuffled.length) * 100}%` }}></div></div>
                        <div className="absolute top-4 right-4 opacity-10 text-9xl font-black text-slate-700 select-none -z-10">{idx + 1}</div>
                        
                        <div className="mb-8 mt-2">
                            <span className="text-xs font-bold text-sci-emerald bg-sci-emerald/10 px-3 py-1 rounded-full uppercase tracking-widest">{fact.topic}</span>
                        </div>
                        
                        <h2 className="text-2xl md:text-3xl font-bold text-white leading-relaxed select-none">
                            {fact.text}
                        </h2>

                        <div className="mt-12 flex justify-between items-center text-slate-500 text-sm">
                            <span className="animate-pulse">Tap for next fact</span>
                            <span>{idx + 1} / {shuffled.length}</span>
                        </div>
                    </div>
                </div>
            );
        };

        // 4. EXAM SIMULATOR
        const ExamSimulator = ({ onBack, updateStats }) => {
            const [idx, setIdx] = useState(0);
            const [score, setScore] = useState(0);
            const [showResult, setShowResult] = useState(false);
            const [selected, setSelected] = useState(null);
            const [shuffledQuestions, setShuffledQuestions] = useState([]);

            useEffect(() => {
                const arr = [...EXAM_QUESTIONS];
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                setShuffledQuestions(arr.slice(0, 20));
            }, []);

            if (shuffledQuestions.length === 0) return <div className="text-center p-10 text-sci-rose">Loading Exam...</div>;

            const q = shuffledQuestions[idx];

            const handleAnswer = (i) => {
                if (selected !== null) return;
                setSelected(i);
                if (i === q.a) {
                    setScore(s => s + 1);
                    confetti({ particleCount: 40, spread: 50, origin: { y: 0.8 }, colors: ['#10b981', '#3b82f6'] });
                }
            };

            const next = () => {
                if (idx < shuffledQuestions.length - 1) {
                    setIdx(i => i + 1);
                    setSelected(null);
                } else {
                    setShowResult(true);
                    updateStats('exam', Math.round((score / shuffledQuestions.length) * 100));
                    confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
                }
            };

            if (showResult) return (
                <div className="max-w-xl mx-auto px-4 py-20 text-center animate-slide-up">
                    <div className="glass-panel p-10 rounded-3xl border-t-4 border-sci-rose">
                        <h2 className="text-3xl font-bold text-white mb-2">Exam Result</h2>
                        <div className="text-7xl font-bold text-sci-emerald my-6">{Math.round((score/shuffledQuestions.length)*100)}%</div>
                        <p className="text-slate-300 text-lg mb-8">Score: {score} / {shuffledQuestions.length}</p>
                        <button onClick={onBack} className="bg-white text-slate-900 px-8 py-3 rounded-full font-bold hover:bg-slate-200 transition">Return to Menu</button>
                    </div>
                </div>
            );

            return (
                <div className="max-w-3xl mx-auto px-4 py-8 animate-slide-up">
                    <div className="flex justify-between items-center mb-6">
                        <button onClick={onBack} className="text-slate-400 hover:text-white flex gap-2"><Icon name="x" /> Quit</button>
                        <span className="font-mono text-sci-rose">Q {idx + 1}/{shuffledQuestions.length}</span>
                    </div>

                    <div className="glass-panel p-6 md:p-10 rounded-3xl mb-6">
                        <h3 className="text-xl md:text-2xl font-bold text-white leading-relaxed mb-8">{q.q}</h3>
                        <div className="space-y-3">
                            {q.options.map((opt, i) => {
                                let style = "border-slate-700 hover:bg-slate-800 bg-slate-900/50";
                                if (selected !== null) {
                                    if (i === q.a) style = "border-sci-emerald bg-sci-emerald/10 text-sci-emerald";
                                    else if (i === selected) style = "border-sci-rose bg-sci-rose/10 text-sci-rose";
                                    else style = "border-slate-800 opacity-40";
                                }
                                return (
                                    <button 
                                        key={i} 
                                        onClick={() => handleAnswer(i)}
                                        className={`w-full text-left p-4 rounded-xl border-2 transition-all font-medium ${style}`}
                                    >
                                        {opt}
                                    </button>
                                );
                            })}
                        </div>
                    </div>

                    {selected !== null && (
                        <div className="glass-panel p-6 rounded-xl border-l-4 border-sci-emerald animate-fade-in mb-20">
                            <h4 className="font-bold text-white mb-2 flex items-center gap-2"><Icon name="check-circle" size={18} /> Explanation</h4>
                            <p className="text-slate-300 text-sm leading-relaxed">{q.expl}</p>
                            <div className="text-right mt-4">
                                <button onClick={next} className="bg-sci-emerald text-slate-900 px-6 py-2 rounded-lg font-bold hover:bg-emerald-400 transition">
                                    {idx === shuffledQuestions.length - 1 ? "Finish" : "Next Question"}
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 5. FLASHCARDS (With Explainer)
        const Flashcards = ({ onBack, updateStats }) => {
            const [index, setIndex] = useState(0);
            const [flipped, setFlipped] = useState(false);
            const [filter, setFilter] = useState('All');
            const [showGuide, setShowGuide] = useState(false);

            const filtered = useMemo(() => filter === 'All' ? FLASHCARDS : FLASHCARDS.filter(c => c.cat === filter), [filter]);
            const card = filtered[index];

            const next = () => {
                setFlipped(false);
                setTimeout(() => {
                    setIndex((index + 1) % filtered.length);
                    updateStats('card', 1);
                }, 200);
            };

            return (
                <div className="max-w-2xl mx-auto h-[85vh] flex flex-col px-4 py-6 animate-slide-up relative">
                    {showGuide && (
                        <div className="absolute inset-0 z-50 bg-slate-900/90 backdrop-blur flex items-center justify-center p-6 animate-fade-in" onClick={() => setShowGuide(false)}>
                            <div className="glass-panel p-8 rounded-2xl border-l-4 border-sci-cyan max-w-md">
                                <h3 className="text-xl font-bold text-white mb-3">Study Mode Guide</h3>
                                <ul className="space-y-2 text-slate-300 text-sm list-disc pl-5">
                                    <li><strong>Active Recall:</strong> Try to answer before flipping.</li>
                                    <li><strong>Spaced Repetition:</strong> We track which cards you view to help you build a daily streak.</li>
                                    <li><strong>Context:</strong> The answer side often contains extra context—read it fully!</li>
                                    <li>Use the <strong>Glossary</strong> if you encounter unknown acronyms.</li>
                                </ul>
                                <p className="mt-6 text-center text-xs text-slate-500">Tap anywhere to close</p>
                            </div>
                        </div>
                    )}

                    <div className="flex justify-between items-center mb-6">
                        <button onClick={onBack} className="text-slate-400 hover:text-white flex items-center gap-2"><Icon name="arrow-left" size={18} /> Home</button>
                        <div className="flex gap-2">
                             <button onClick={() => setShowGuide(true)} className="text-slate-400 hover:text-sci-cyan transition"><Icon name="help-circle" size={20} /></button>
                             <select onChange={(e) => { setFilter(e.target.value); setIndex(0); setFlipped(false); }} className="bg-slate-800 text-white border border-slate-700 rounded-lg px-3 py-1 outline-none focus:border-sci-cyan text-sm">
                                {['All', 'Stats', 'Nerves', 'Muscle', 'Sensory', 'Transport', 'ANS'].map(opt => <option key={opt} value={opt}>{opt}</option>)}
                            </select>
                        </div>
                    </div>

                    <div className="flex-1 relative group perspective-1000 cursor-pointer" onClick={() => setFlipped(!flipped)}>
                        <div className={`relative w-full h-full duration-500 transform-style-3d ${flipped ? 'rotate-y-180' : ''}`}>
                            <div className="absolute inset-0 backface-hidden glass-panel rounded-3xl border border-slate-600 p-8 flex flex-col items-center justify-center text-center shadow-2xl">
                                <span className="mb-4 px-3 py-1 bg-slate-800 rounded-full text-xs font-bold text-sci-cyan uppercase tracking-widest">{card.cat}</span>
                                <h2 className="text-2xl md:text-3xl font-bold text-white leading-snug select-none">{card.q}</h2>
                                <p className="absolute bottom-8 text-slate-500 text-sm animate-pulse">Tap to Flip</p>
                            </div>
                            <div className="absolute inset-0 backface-hidden rotate-y-180 bg-slate-900 rounded-3xl border border-sci-purple p-8 flex flex-col items-center justify-center text-center shadow-2xl">
                                <p className="text-lg md:text-xl text-slate-200 leading-relaxed font-medium select-none">{card.a}</p>
                            </div>
                        </div>
                    </div>

                    <div className="mt-8 flex justify-center">
                        <button onClick={next} className="bg-white text-slate-900 px-12 py-3 rounded-full font-bold hover:bg-slate-200 transition shadow-lg">Next Card</button>
                    </div>
                </div>
            );
        };

        // 6. CALCULATORS
        const Calculators = ({ onBack }) => {
            const [nernst, setNernst] = useState({ z: 1, out: 5, in: 150 });
            const nernstVal = (61.5 / nernst.z * Math.log10(nernst.out / nernst.in)).toFixed(1);

            return (
                <div className="max-w-4xl mx-auto px-4 py-8 animate-slide-up">
                    <button onClick={onBack} className="mb-6 text-slate-400 hover:text-white flex gap-2"><Icon name="arrow-left" /> Back</button>
                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="glass-panel p-6 rounded-2xl border-t-4 border-sci-purple">
                            <h3 className="font-bold text-white mb-4">Nernst Potential (37°C)</h3>
                            <div className="space-y-4 text-sm">
                                <div className="grid grid-cols-2 gap-4">
                                    <div><label className="text-xs text-slate-400 block mb-1">Out (mM)</label><input type="number" value={nernst.out} onChange={e=>setNernst({...nernst, out: e.target.value})} className="w-full bg-slate-900 p-2 rounded text-white border border-slate-700"/></div>
                                    <div><label className="text-xs text-slate-400 block mb-1">In (mM)</label><input type="number" value={nernst.in} onChange={e=>setNernst({...nernst, in: e.target.value})} className="w-full bg-slate-900 p-2 rounded text-white border border-slate-700"/></div>
                                </div>
                                <div><label className="text-xs text-slate-400 block mb-1">Charge (z)</label><input type="number" value={nernst.z} onChange={e=>setNernst({...nernst, z: e.target.value})} className="w-full bg-slate-900 p-2 rounded text-white border border-slate-700"/></div>
                                <div className="text-center pt-2">
                                    <div className="text-4xl font-mono font-bold text-sci-purple">{nernstVal} mV</div>
                                </div>
                            </div>
                        </div>
                        <div className="glass-panel p-6 rounded-2xl border-t-4 border-sci-amber">
                            <h3 className="font-bold text-white mb-3">Stats Decision Helper</h3>
                            <div className="space-y-3 text-sm text-slate-300">
                                <p><strong>Unpaired t-test:</strong> 2 Separate groups (e.g. Toads vs Mice).</p>
                                <p><strong>Paired t-test:</strong> Same group measured twice (e.g. Pre vs Post).</p>
                                <p><strong>SEM:</strong> Use for Error Bars (Precision).</p>
                                <p><strong>SD:</strong> Use to describe variability/spread.</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 7. GHK SIMULATOR
        const GHKSimulator = () => {
            const [p, setP] = useState({ k: 1, na: 0.04, cl: 0.45 });
            const [c, setC] = useState({
                out: { k: 5, na: 145, cl: 110 },
                in: { k: 140, na: 15, cl: 10 }
            });
            const [preset, setPreset] = useState('rest');

            const calculateVm = () => {
                const RTF = 61.5;
                const num = (p.k * c.out.k) + (p.na * c.out.na) + (p.cl * c.in.cl);
                const den = (p.k * c.in.k) + (p.na * c.in.na) + (p.cl * c.out.cl);
                if (den === 0) return 0;
                return (RTF * Math.log10(num / den)).toFixed(1);
            };

            const vm = parseFloat(calculateVm());

            const applyPreset = (type) => {
                setPreset(type);
                if (type === 'rest') setP({ k: 1, na: 0.04, cl: 0.45 });
                if (type === 'depol') setP({ k: 1, na: 20, cl: 0.45 });
                if (type === 'repol') setP({ k: 15, na: 0.04, cl: 0.45 });
            };

            return (
                <div className="glass-panel p-6 rounded-2xl animate-slide-up">
                    <div className="flex flex-col sm:flex-row justify-between items-start gap-4 mb-6">
                        <div>
                            <h3 className="text-xl font-bold flex items-center gap-2"><Icon name="sliders" /> GHK Simulator</h3>
                            <p className="text-xs text-slate-400 mt-1">Goldman-Hodgkin-Katz Equation at 37°C</p>
                        </div>
                        <div className="text-right">
                             <div className={`text-4xl font-mono font-bold transition-colors duration-300 ${vm > -55 ? 'text-sci-emerald' : 'text-sci-cyan'}`} aria-live="polite">
                                {vm} <span className="text-lg">mV</span>
                            </div>
                            <div className="text-xs text-slate-500">Membrane Potential (Vm)</div>
                        </div>
                    </div>

                    <div className="flex flex-wrap gap-2 mb-8 bg-slate-900/50 p-2 rounded-lg">
                        <button type="button" onClick={() => applyPreset('rest')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition ${preset === 'rest' ? 'bg-slate-700 text-white shadow' : 'text-slate-400 hover:text-white'}`}>Resting</button>
                        <button type="button" onClick={() => applyPreset('depol')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition ${preset === 'depol' ? 'bg-sci-emerald text-slate-900 shadow' : 'text-slate-400 hover:text-white'}`}>Depolarization (Na+ Open)</button>
                        <button type="button" onClick={() => applyPreset('repol')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition ${preset === 'repol' ? 'bg-sci-purple text-white shadow' : 'text-slate-400 hover:text-white'}`}>Repolarization (K+ Open)</button>
                    </div>

                    <div className="space-y-6">
                        <div className="bg-slate-800/40 p-4 rounded-xl border border-slate-700">
                            <div className="flex justify-between mb-2">
                                <label htmlFor="permeability-k" className="text-sci-purple font-bold">P<sub>K+</sub> (Permeability)</label>
                                <span className="font-mono text-sm" aria-live="polite">{p.k.toFixed(2)}</span>
                            </div>
                            <input
                                id="permeability-k"
                                type="range"
                                min="0"
                                max="20"
                                step="0.1"
                                value={p.k}
                                onChange={(e) => {setPreset('custom'); setP({...p, k: parseFloat(e.target.value)})}}
                                className="w-full"
                            />

                            <div className="mt-4 flex flex-col sm:flex-row gap-4 text-xs text-slate-400">
                                <div className="flex-1">
                                    <label htmlFor="k-out">[K+] Out (mM)</label>
                                    <input
                                        id="k-out"
                                        type="number"
                                        value={c.out.k}
                                        onChange={(e) => setC({...c, out: {...c.out, k: parseFloat(e.target.value || 0)}})}
                                        className="w-full bg-slate-900 border border-slate-700 rounded p-1 mt-1 text-slate-200"
                                    />
                                </div>
                                <div className="flex-1">
                                    <label htmlFor="k-in">[K+] In (mM)</label>
                                    <input
                                        id="k-in"
                                        type="number"
                                        disabled
                                        value={c.in.k}
                                        className="w-full bg-slate-900/50 border border-slate-800 rounded p-1 mt-1 text-slate-500 cursor-not-allowed"
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="bg-slate-800/40 p-4 rounded-xl border border-slate-700">
                            <div className="flex justify-between mb-2">
                                <label htmlFor="permeability-na" className="text-sci-emerald font-bold">P<sub>Na+</sub> (Permeability)</label>
                                <span className="font-mono text-sm" aria-live="polite">{p.na.toFixed(2)}</span>
                            </div>
                            <input
                                id="permeability-na"
                                type="range"
                                min="0"
                                max="30"
                                step="0.1"
                                value={p.na}
                                onChange={(e) => {setPreset('custom'); setP({...p, na: parseFloat(e.target.value)})}}
                                className="w-full"
                            />
                            <p className="mt-3 text-xs text-slate-400">Tip: higher P<sub>Na</sub> quickly shifts Vm toward E<sub>Na</sub>.</p>
                        </div>
                    </div>
                </div>
            );
        };

        // 8. ACTION POTENTIAL EXPLORER
        const APExplorer = () => {
            const [phase, setPhase] = useState(0);

            const phases = [
                { id: 0, title: "Resting State", vm: "-70mV", na: "Closed", k: "Closed", desc: "Leak K+ channels dominate. Vm is close to Ek." },
                { id: 1, title: "Depolarization", vm: "Rises to +30mV", na: "OPEN", k: "Closed (lag)", desc: "Threshold reached! Voltage-gated Na+ channels open rapidly. Na+ rushes IN." },
                { id: 2, title: "Peak / Overshoot", vm: "+30mV", na: "Inactivating", k: "Opening", desc: "Vm nears E_Na. Na+ channels begin to block (ball & chain). K+ channels start opening." },
                { id: 3, title: "Repolarization", vm: "Falls to -80mV", na: "Inactivated", k: "OPEN", desc: "Na+ influx stops. K+ rushes OUT through open voltage-gated channels, reducing Vm." },
                { id: 4, title: "Hyperpolarization", vm: "-85mV", na: "Resetting", k: "Closing slowly", desc: "K+ channels close slowly, causing undershoot. Na+ channels reset to closed state." }
            ];

            const current = phases[phase];

            return (
                <div className="glass-panel p-6 rounded-2xl border-l-4 border-sci-cyan animate-slide-up">
                    <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                        <Icon name="activity" /> Action Potential Explorer
                    </h3>

                    <div className="flex flex-col md:flex-row gap-8">
                        <button
                            type="button"
                            className="flex-1 relative h-64 bg-slate-900/50 rounded-xl border border-slate-700 overflow-hidden cursor-pointer text-left"
                            onClick={() => setPhase((phase + 1) % 5)}
                            aria-label="Advance action potential phase"
                        >
                            <svg viewBox="0 0 300 150" className="w-full h-full stroke-2" role="img" aria-label="Action potential trace with highlighted phase">
                                <line x1="0" y1="100" x2="300" y2="100" stroke="#334155" strokeDasharray="4" />
                                <line x1="0" y1="50" x2="300" y2="50" stroke="#334155" strokeDasharray="4" />

                                <path d="M 10 100 L 50 100 Q 70 100 80 50 L 90 20 Q 100 10 110 50 L 130 110 Q 150 130 180 110 L 220 100 L 290 100"
                                      fill="none" stroke="#64748b" strokeWidth="3" />

                                {phase === 0 && <circle cx="30" cy="100" r="6" fill="#06b6d4" className="animate-pulse" />}
                                {phase === 1 && <path d="M 50 100 Q 70 100 80 50 L 90 20" fill="none" stroke="#06b6d4" strokeWidth="5" />}
                                {phase === 2 && <circle cx="90" cy="20" r="6" fill="#06b6d4" className="animate-pulse" />}
                                {phase === 3 && <path d="M 90 20 Q 100 10 110 50 L 130 110" fill="none" stroke="#06b6d4" strokeWidth="5" />}
                                {phase === 4 && <path d="M 130 110 Q 150 130 180 110 L 220 100" fill="none" stroke="#06b6d4" strokeWidth="5" />}
                            </svg>
                            <div className="absolute bottom-2 right-2 text-xs text-slate-500">Click graph to advance</div>
                        </button>

                        <div className="flex-1 space-y-4">
                            <div>
                                <h4 className="text-2xl font-bold text-sci-cyan">{current.title}</h4>
                                <div className="text-3xl font-mono mt-1" aria-live="polite">{current.vm}</div>
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <div className={`p-3 rounded-lg border ${current.na === 'OPEN' ? 'bg-sci-emerald/20 border-sci-emerald text-sci-emerald' : 'bg-slate-800 border-slate-700'}`}>
                                    <div className="text-xs text-slate-400 uppercase">Na+ Channels</div>
                                    <div className="font-bold">{current.na}</div>
                                </div>
                                <div className={`p-3 rounded-lg border ${current.k === 'OPEN' ? 'bg-sci-purple/20 border-sci-purple text-sci-purple' : 'bg-slate-800 border-slate-700'}`}>
                                    <div className="text-xs text-slate-400 uppercase">K+ Channels</div>
                                    <div className="font-bold">{current.k}</div>
                                </div>
                            </div>

                            <p className="text-sm text-slate-300 leading-relaxed bg-slate-800/50 p-3 rounded-lg border-l-2 border-slate-600">
                                {current.desc}
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // 9. MUSCLE ENGINE
        const MuscleEngine = ({ onBack }) => {
            const data = [
                { f: "Ca2+ Sensor", s: "Troponin C", c: "Troponin C", m: "Calmodulin" },
                { f: "Ca2+ Source", s: "SR Only", c: "ECF + SR", m: "ECF + SR" },
                { f: "Coupling", s: "Mechanical", c: "CICR", m: "Pharmaco/Electro" },
                { f: "Regulation", s: "Actin-based", c: "Actin-based", m: "Myosin-based" }
            ];

            return (
                <div className="max-w-5xl mx-auto px-4 py-8 animate-slide-up">
                    <button onClick={onBack} className="mb-6 text-slate-400 hover:text-white flex gap-2"><Icon name="arrow-left" /> Back</button>
                    <div className="glass-panel rounded-2xl overflow-hidden">
                        <table className="w-full text-left">
                            <thead className="bg-slate-900/50 text-xs uppercase text-slate-400">
                                <tr>
                                    <th className="p-4">Feature</th>
                                    <th className="p-4 text-sci-rose">Skeletal</th>
                                    <th className="p-4 text-sci-cyan">Cardiac</th>
                                    <th className="p-4 text-sci-amber">Smooth</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-700/50 text-sm text-slate-200">
                                {data.map((row, i) => (
                                    <tr key={i} className="hover:bg-slate-800/50 transition">
                                        <td className="p-4 font-bold">{row.f}</td>
                                        <td className="p-4">{row.s}</td>
                                        <td className="p-4">{row.c}</td>
                                        <td className="p-4">{row.m}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // --- APP ROOT ---
        const App = () => {
            const [view, setView] = useState('dashboard');
            const [stats, setStats] = useState({ cardsLearned: 0, quizScore: 0, streak: 1, cramCount: 0 });

            useEffect(() => {
                const saved = localStorage.getItem('phyl_stats');
                if (saved) setStats(JSON.parse(saved));
            }, []);

            const updateStats = (key, val) => {
                const newStats = { ...stats };
                if (key === 'exam') newStats.quizScore = Math.max(stats.quizScore, val);
                if (key === 'cram') newStats.cramCount += val;
                if (key === 'card') newStats.cardsLearned += val;
                setStats(newStats);
                localStorage.setItem('phyl_stats', JSON.stringify(newStats));
            };

            const resetProgress = () => {
                if(confirm("Reset all progress?")) {
                    localStorage.removeItem('phyl_stats');
                    window.location.reload();
                }
            };

            return (
                <div className="min-h-screen pb-12">
                    <nav className="border-b border-white/5 bg-slate-900/50 backdrop-blur sticky top-0 z-50">
                        <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2 font-bold text-white cursor-pointer" onClick={() => setView('dashboard')}>
                                <div className="w-8 h-8 rounded bg-gradient-to-br from-sci-cyan to-sci-purple flex items-center justify-center">P</div>
                                <span className="hidden md:inline">PHYL2002</span>
                            </div>
                        </div>
                    </nav>

                    <main id="main" className="pt-6">
                        {view === 'dashboard' && <Dashboard setView={setView} stats={stats} onReset={resetProgress} />}
                        {view === 'cram' && <CramMode onBack={() => setView('dashboard')} updateStats={updateStats} />}
                        {view === 'exam' && <ExamSimulator onBack={() => setView('dashboard')} updateStats={updateStats} />}
                        {view === 'flashcards' && <Flashcards onBack={() => setView('dashboard')} updateStats={updateStats} />}
                        {view === 'terms' && <Glossary onBack={() => setView('dashboard')} />}
                        {view === 'calc' && <Calculators onBack={() => setView('dashboard')} />}
                        {view === 'ghk' && (
                            <div className="max-w-5xl mx-auto px-4 py-8 animate-slide-up">
                                <button onClick={() => setView('dashboard')} className="mb-6 text-slate-400 hover:text-white flex gap-2"><Icon name="arrow-left" /> Back</button>
                                <div className="grid lg:grid-cols-2 gap-6">
                                    <div className="space-y-6">
                                        <div className="glass-panel p-6 rounded-2xl">
                                            <h3 className="text-2xl font-bold text-white mb-2">Understanding RMP</h3>
                                            <p className="text-slate-300 leading-relaxed text-sm">
                                                The Goldman-Hodgkin-Katz equation uses ion permeability and concentration gradients to estimate membrane potential. Increasing
                                                P<sub>Na</sub> depolarizes Vm, while increasing P<sub>K</sub> brings Vm closer to E<sub>K</sub>.
                                            </p>
                                        </div>
                                        <div className="glass-panel p-6 rounded-2xl">
                                            <h4 className="text-lg font-bold text-white mb-2">Try This</h4>
                                            <ul className="list-disc list-inside text-slate-300 text-sm space-y-2">
                                                <li>Use the Depolarization preset to simulate Na+ channel opening.</li>
                                                <li>Increase extracellular K+ to mimic hyperkalemia and watch Vm rise.</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <GHKSimulator />
                                </div>
                            </div>
                        )}
                        {view === 'ap' && (
                            <div className="max-w-5xl mx-auto px-4 py-8 animate-slide-up">
                                <button onClick={() => setView('dashboard')} className="mb-6 text-slate-400 hover:text-white flex gap-2"><Icon name="arrow-left" /> Back</button>
                                <APExplorer />
                            </div>
                        )}
                        {view === 'muscle' && <MuscleEngine onBack={() => setView('dashboard')} />}
                    </main>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
