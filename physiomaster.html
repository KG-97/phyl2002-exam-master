<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="PhysioMaster Pro: interactive cellular physiology tools with flashcards, GHK simulator, and action potential explorer." />
    <title>PhysioMaster Pro: Cellular Physiology</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Chart/Graph Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#151e2e',
                            900: '#0f172a',
                            950: '#020617'
                        },
                        sci: {
                            accent: '#38bdf8', // Blue/Cyan
                            secondary: '#818cf8', // Indigo
                            success: '#34d399', // Emerald
                            warning: '#fbbf24', // Amber
                            danger: '#f87171', // Red
                            purple: '#c084fc'
                        }
                    },
                    animation: {
                        'flip': 'flip 0.6s preserve-3d',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'pulse-slow': 'pulse 3s infinite'
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                },
            },
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');

        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }

        :focus-visible {
            outline: 2px solid #38bdf8;
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* Glassmorphism utilities */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* Input Range Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px; width: 16px;
            border-radius: 50%;
            background: #38bdf8;
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(56,189,248,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer;
            background: #334155;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen overflow-x-hidden selection:bg-sci-accent selection:text-slate-900">
    <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:bg-slate-900 focus:text-white focus:px-4 focus:py-2 focus:rounded-lg">Skip to main content</a>
    <div id="root"></div>

    <!-- React Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- DATA STORE ---
        const TOPICS = {
            MEMBRANE: 'Membrane Dynamics',
            ACTION: 'Action Potentials',
            SYNAPSE: 'Synaptic Transmission',
            TRANSPORT: 'Cellular Transport'
        };

        const DATA = [
            // MEMBRANE POTENTIAL
            { id: 101, topic: 'MEMBRANE', q: "What determines the Resting Membrane Potential (RMP)?", a: "High resting permeability to K+ (via leak channels) vs low Na+ permeability. The Na+/K+ pump maintains the gradients, but leak channels set the voltage.", type: 'conc' },
            { id: 102, topic: 'MEMBRANE', q: "Effect of Hyperkalemia on RMP?", a: "Increased extracellular K+ reduces the gradient for K+ efflux. Nernst for K+ becomes less negative -> Cell depolarizes -> Increased excitability (initially).", type: 'mech' },
            { id: 103, topic: 'MEMBRANE', q: "Nernst vs Goldman (GHK) Equations?", a: "Nernst: Equilibrium potential for ONE ion. GHK: Membrane potential based on permeabilities (P) and concentrations of ALL ions (K+, Na+, Cl-).", type: 'def' },
            { id: 104, topic: 'MEMBRANE', q: "What happens to a cell in a hypertonic solution?", a: "Water leaves the cell because extracellular non-penetrating solute is higher -> cell shrinks (crenation).", type: 'conc' },
            { id: 105, topic: 'MEMBRANE', q: "Why is urea considered hypotonic despite being isosmotic?", a: "Urea is a penetrating solute; it equilibrates across the membrane, so water still moves in and can cause swelling.", type: 'mech' },

            // ACTION POTENTIAL
            { id: 201, topic: 'ACTION', q: "Ionic basis of the Upstroke (Depolarization)?", a: "Opening of Voltage-Gated Na+ channels. P_Na increases >1000x, driving Vm towards E_Na (+60mV).", type: 'mech' },
            { id: 202, topic: 'ACTION', q: "Mechanism of Repolarization?", a: "1. Na+ channels Inactivate (ball & chain). 2. Voltage-Gated K+ channels Open (delayed rectifiers), increasing P_K and driving Vm back towards E_K.", type: 'mech' },
            { id: 203, topic: 'ACTION', q: "Absolute vs Relative Refractory Period?", a: "Absolute: Na+ channels inactivated (cannot reopen). Relative: Na+ channels recovered, but K+ channels still open (hyperpolarized state, needs stronger stimulus).", type: 'mech' },
            { id: 204, topic: 'ACTION', q: "Saltatory Conduction", a: "In myelinated axons, myelin insulates preventing leak. Action potentials regenerate only at Nodes of Ranvier. Increases speed and efficiency.", type: 'def' },
            { id: 205, topic: 'ACTION', q: "What triggers voltage-gated Na+ channel opening?", a: "Membrane depolarization to threshold rapidly opens activation gates, allowing Na+ influx.", type: 'mech' },
            { id: 206, topic: 'ACTION', q: "Why does myelination speed conduction?", a: "It increases membrane resistance and lowers capacitance, enabling faster saltatory conduction between nodes.", type: 'def' },

            // SYNAPSE
            { id: 301, topic: 'SYNAPSE', q: "Vesicle Fusion Trigger?", a: "Depolarization at terminal -> Opening of Voltage-Gated Ca2+ channels -> Ca2+ influx -> Binding to Synaptotagmin -> SNARE complex fusion.", type: 'mech' },
            { id: 302, topic: 'SYNAPSE', q: "IPSP Ionic Mechanism", a: "Inhibitory Post-Synaptic Potential. Usually caused by opening Cl- channels (influx) or K+ channels (efflux), keeping Vm away from threshold.", type: 'mech' },
            { id: 303, topic: 'SYNAPSE', q: "Spatial vs Temporal Summation", a: "Spatial: Multiple inputs at different locations firing at once. Temporal: Single input firing repeatedly in rapid succession.", type: 'def' },
            { id: 304, topic: 'SYNAPSE', q: "What is the role of synaptotagmin?", a: "It senses Ca2+ influx and triggers SNARE-mediated vesicle fusion with the presynaptic membrane.", type: 'mech' },
            { id: 305, topic: 'SYNAPSE', q: "EPSP ionic mechanism", a: "Excitatory Post-Synaptic Potential typically involves opening cation channels, allowing Na+ influx and depolarization.", type: 'mech' },

            // TRANSPORT
            { id: 401, topic: 'TRANSPORT', q: "Primary vs Secondary Active Transport", a: "Primary: Uses ATP directly (Na/K ATPase). Secondary: Uses energy from a gradient created by primary transport (e.g. SGLT1 uses Na+ gradient).", type: 'def' },
            { id: 402, topic: 'TRANSPORT', q: "Fick's Law of Diffusion variables", a: "Rate depends on: Surface Area (A), Concentration Gradient (dC), Membrane Permeability (P), and is inversely proportional to Thickness/Distance.", type: 'conc' },
            { id: 403, topic: 'TRANSPORT', q: "What distinguishes facilitated diffusion from simple diffusion?", a: "Facilitated diffusion uses membrane proteins and saturates; simple diffusion does not saturate and depends only on the gradient.", type: 'def' },
            { id: 404, topic: 'TRANSPORT', q: "What is the net effect of the Na+/K+ ATPase per cycle?", a: "Three Na+ out and two K+ in, generating a net -1 charge inside (electrogenic).", type: 'mech' }
        ];

        // --- ICONS ---
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { lucide.createIcons(); }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // --- HOOKS ---
        // Persistence Hook
        const useStickyState = (defaultValue, key) => {
            const [value, setValue] = useState(() => {
                const stickyValue = window.localStorage.getItem(key);
                return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
            });
            useEffect(() => {
                window.localStorage.setItem(key, JSON.stringify(value));
            }, [key, value]);
            return [value, setValue];
        };

        // --- COMPONENTS ---

        // 1. ACTION POTENTIAL EXPLORER
        const APExplorer = () => {
            const [phase, setPhase] = useState(0); // 0:Rest, 1:Depol, 2:Peak, 3:Repol, 4:Hyper, 5:Rest

            const phases = [
                { id: 0, title: "Resting State", vm: "-70mV", na: "Closed", k: "Closed", desc: "Leak K+ channels dominate. Vm is close to Ek." },
                { id: 1, title: "Depolarization", vm: "Rises to +30mV", na: "OPEN", k: "Closed (lag)", desc: "Threshold reached! Voltage-gated Na+ channels open rapidly. Na+ rushes IN." },
                { id: 2, title: "Peak / Overshoot", vm: "+30mV", na: "Inactivating", k: "Opening", desc: "Vm nears E_Na. Na+ channels begin to block (ball & chain). K+ channels start opening." },
                { id: 3, title: "Repolarization", vm: "Falls to -80mV", na: "Inactivated", k: "OPEN", desc: "Na+ influx stops. K+ rushes OUT through open voltage-gated channels, reducing Vm." },
                { id: 4, title: "Hyperpolarization", vm: "-85mV", na: "Resetting", k: "Closing slowly", desc: "K+ channels close slowly, causing 'undershoot'. Na+ channels reset to closed state." }
            ];

            const current = phases[phase];

            return (
                <div className="glass-panel p-6 rounded-2xl border-l-4 border-sci-accent animate-slide-up">
                    <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                        <Icon name="activity" /> Action Potential Explorer
                    </h3>

                    <div className="flex flex-col md:flex-row gap-8">
                        {/* Interactive Graph SVG */}
                        <button
                            type="button"
                            className="flex-1 relative h-64 bg-slate-900/50 rounded-xl border border-slate-700 overflow-hidden cursor-pointer text-left"
                            onClick={() => setPhase((phase + 1) % 5)}
                            aria-label="Advance action potential phase"
                        >
                            <svg viewBox="0 0 300 150" className="w-full h-full stroke-2" role="img" aria-label="Action potential trace with highlighted phase">
                                {/* Grid */}
                                <line x1="0" y1="100" x2="300" y2="100" stroke="#334155" strokeDasharray="4" /> {/* -70mV */}
                                <line x1="0" y1="50" x2="300" y2="50" stroke="#334155" strokeDasharray="4" /> {/* 0mV */}

                                {/* AP Trace */}
                                <path d="M 10 100 L 50 100 Q 70 100 80 50 L 90 20 Q 100 10 110 50 L 130 110 Q 150 130 180 110 L 220 100 L 290 100"
                                      fill="none" stroke="#64748b" strokeWidth="3" />

                                {/* Active Phase Highlight */}
                                {phase === 0 && <circle cx="30" cy="100" r="6" fill="#38bdf8" className="animate-pulse" />}
                                {phase === 1 && <path d="M 50 100 Q 70 100 80 50 L 90 20" fill="none" stroke="#38bdf8" strokeWidth="5" />}
                                {phase === 2 && <circle cx="90" cy="20" r="6" fill="#38bdf8" className="animate-pulse" />}
                                {phase === 3 && <path d="M 90 20 Q 100 10 110 50 L 130 110" fill="none" stroke="#38bdf8" strokeWidth="5" />}
                                {phase === 4 && <path d="M 130 110 Q 150 130 180 110 L 220 100" fill="none" stroke="#38bdf8" strokeWidth="5" />}
                            </svg>
                            <div className="absolute bottom-2 right-2 text-xs text-slate-500">Click graph to advance</div>
                        </button>

                        {/* Info Panel */}
                        <div className="flex-1 space-y-4">
                            <div>
                                <h4 className="text-2xl font-bold text-sci-accent">{current.title}</h4>
                                <div className="text-3xl font-mono mt-1" aria-live="polite">{current.vm}</div>
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <div className={`p-3 rounded-lg border ${current.na === 'OPEN' ? 'bg-sci-success/20 border-sci-success text-sci-success' : 'bg-slate-800 border-slate-700'}`}>
                                    <div className="text-xs text-slate-400 uppercase">Na+ Channels</div>
                                    <div className="font-bold">{current.na}</div>
                                </div>
                                <div className={`p-3 rounded-lg border ${current.k === 'OPEN' ? 'bg-sci-purple/20 border-sci-purple text-sci-purple' : 'bg-slate-800 border-slate-700'}`}>
                                    <div className="text-xs text-slate-400 uppercase">K+ Channels</div>
                                    <div className="font-bold">{current.k}</div>
                                </div>
                            </div>

                            <p className="text-sm text-slate-300 leading-relaxed bg-slate-800/50 p-3 rounded-lg border-l-2 border-slate-600">
                                {current.desc}
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // 2. GHK SIMULATOR
        const GHKSimulator = () => {
            // State for Concentrations (C) and Permeability (P)
            // Standard Mammalian Neuron values
            const [p, setP] = useState({ k: 1, na: 0.04, cl: 0.45 });
            const [c, setC] = useState({
                out: { k: 5, na: 145, cl: 110 },
                in: { k: 140, na: 15, cl: 10 }
            });
            const [preset, setPreset] = useState('rest');

            const calculateVm = () => {
                const RTF = 61.5; // at 37C
                const num = (p.k * c.out.k) + (p.na * c.out.na) + (p.cl * c.in.cl);
                const den = (p.k * c.in.k) + (p.na * c.in.na) + (p.cl * c.out.cl);
                if (den === 0) return 0;
                return (RTF * Math.log10(num / den)).toFixed(1);
            };

            const vm = parseFloat(calculateVm());

            // Handle presets
            const applyPreset = (type) => {
                setPreset(type);
                if(type === 'rest') setP({ k: 1, na: 0.04, cl: 0.45 });
                if(type === 'depol') setP({ k: 1, na: 20, cl: 0.45 }); // Massive Na increase
                if(type === 'repol') setP({ k: 15, na: 0.04, cl: 0.45 }); // Massive K increase
            };

            return (
                <div className="glass-panel p-6 rounded-2xl animate-slide-up">
                    <div className="flex flex-col sm:flex-row justify-between items-start gap-4 mb-6">
                        <div>
                            <h3 className="text-xl font-bold flex items-center gap-2"><Icon name="sliders" /> GHK Simulator</h3>
                            <p className="text-xs text-slate-400 mt-1">Goldman-Hodgkin-Katz Equation at 37Â°C</p>
                        </div>
                        <div className="text-right">
                             <div className={`text-4xl font-mono font-bold transition-colors duration-300 ${vm > -55 ? 'text-sci-success' : 'text-sci-accent'}`} aria-live="polite">
                                {vm} <span className="text-lg">mV</span>
                            </div>
                            <div className="text-xs text-slate-500">Membrane Potential (Vm)</div>
                        </div>
                    </div>

                    {/* Presets */}
                    <div className="flex flex-wrap gap-2 mb-8 bg-slate-900/50 p-2 rounded-lg">
                        <button type="button" onClick={() => applyPreset('rest')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition ${preset === 'rest' ? 'bg-slate-700 text-white shadow' : 'text-slate-400 hover:text-white'}`}>Resting</button>
                        <button type="button" onClick={() => applyPreset('depol')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition ${preset === 'depol' ? 'bg-sci-success text-slate-900 shadow' : 'text-slate-400 hover:text-white'}`}>Depolarization (Na+ Open)</button>
                        <button type="button" onClick={() => applyPreset('repol')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition ${preset === 'repol' ? 'bg-sci-purple text-white shadow' : 'text-slate-400 hover:text-white'}`}>Repolarization (K+ Open)</button>
                    </div>

                    <div className="space-y-6">
                        {/* Potassium Control */}
                        <div className="bg-slate-800/40 p-4 rounded-xl border border-slate-700">
                            <div className="flex justify-between mb-2">
                                <label htmlFor="permeability-k" className="text-sci-purple font-bold">P<sub>K+</sub> (Permeability)</label>
                                <span className="font-mono text-sm" aria-live="polite">{p.k.toFixed(2)}</span>
                            </div>
                            <input
                                id="permeability-k"
                                type="range"
                                min="0"
                                max="20"
                                step="0.1"
                                value={p.k}
                                onChange={(e) => {setPreset('custom'); setP({...p, k: parseFloat(e.target.value)})}}
                                className="w-full"
                            />

                            <div className="mt-4 flex flex-col sm:flex-row gap-4 text-xs text-slate-400">
                                <div className="flex-1">
                                    <label htmlFor="k-out">[K+] Out (mM)</label>
                                    <input
                                        id="k-out"
                                        type="number"
                                        value={c.out.k}
                                        onChange={(e) => setC({...c, out: {...c.out, k: parseFloat(e.target.value || 0)}})}
                                        className="w-full bg-slate-900 border border-slate-700 rounded p-1 mt-1 text-slate-200"
                                    />
                                </div>
                                <div className="flex-1">
                                    <label htmlFor="k-in">[K+] In (mM)</label>
                                    <input
                                        id="k-in"
                                        type="number"
                                        disabled
                                        value={c.in.k}
                                        className="w-full bg-slate-900/50 border border-slate-800 rounded p-1 mt-1 text-slate-500 cursor-not-allowed"
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Sodium Control */}
                        <div className="bg-slate-800/40 p-4 rounded-xl border border-slate-700">
                            <div className="flex justify-between mb-2">
                                <label htmlFor="permeability-na" className="text-sci-success font-bold">P<sub>Na+</sub> (Permeability)</label>
                                <span className="font-mono text-sm" aria-live="polite">{p.na.toFixed(2)}</span>
                            </div>
                            <input
                                id="permeability-na"
                                type="range"
                                min="0"
                                max="30"
                                step="0.1"
                                value={p.na}
                                onChange={(e) => {setPreset('custom'); setP({...p, na: parseFloat(e.target.value)})}}
                                className="w-full"
                            />
                            <p className="mt-3 text-xs text-slate-400">Tip: higher P<sub>Na</sub> quickly shifts Vm toward E<sub>Na</sub>.</p>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. FLASHCARDS with LEITNER SYSTEM
        const Flashcards = ({ onXP }) => {
            const [mastery, setMastery] = useStickyState({}, 'physio_mastery');
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);

            // Sort cards by mastery (show unmastered first)
            const cards = useMemo(() => {
                return [...DATA].sort((a, b) => {
                    const mA = mastery[a.id] || 0;
                    const mB = mastery[b.id] || 0;
                    return mA - mB;
                });
            }, [mastery]);

            const currentCard = cards[currentIndex];
            const currentMastery = mastery[currentCard.id] || 0;

            const handleRate = (score) => {
                // Score: 1=Hard, 3=Good, 5=Easy
                const newMastery = Math.min((mastery[currentCard.id] || 0) + score, 10);
                setMastery({ ...mastery, [currentCard.id]: newMastery });

                // Give XP
                onXP(score * 5);

                setIsFlipped(false);
                setTimeout(() => {
                    setCurrentIndex((prev) => (prev + 1) % cards.length);
                }, 300);
            };

            // Keyboard shortcuts
            useEffect(() => {
                const handleKey = (e) => {
                    if(e.code === 'Space') {
                        const target = e.target;
                        if (target instanceof HTMLElement) {
                            const isInteractive = target.closest(
                                'button, [role="button"], input, textarea, select, [contenteditable="true"]'
                            );
                            if (isInteractive) {
                                return;
                            }
                        }
                        e.preventDefault();
                        setIsFlipped(f => !f);
                    }
                    if(isFlipped) {
                        if(e.code === 'ArrowLeft') handleRate(1); // Hard
                        if(e.code === 'ArrowRight') handleRate(5); // Easy
                    }
                };
                window.addEventListener('keydown', handleKey);
                return () => window.removeEventListener('keydown', handleKey);
            }, [isFlipped, currentCard]); // Dependencies for closure

            return (
                <div className="max-w-2xl mx-auto h-[600px] flex flex-col animate-slide-up">
                    <div className="flex justify-between mb-4 items-center">
                        <span className="text-slate-400 text-sm font-mono">Card {currentIndex + 1} / {cards.length}</span>
                        <div className="flex items-center gap-2">
                            <span className="text-xs text-slate-500 uppercase">Mastery</span>
                            <div className="w-24 h-2 bg-slate-800 rounded-full overflow-hidden" aria-hidden="true">
                                <div className="h-full bg-sci-success transition-all duration-500" style={{width: `${currentMastery * 10}%`}}></div>
                            </div>
                        </div>
                    </div>

                    <button
                        type="button"
                        className="relative flex-1 group perspective-1000 cursor-pointer text-left"
                        onClick={() => setIsFlipped(!isFlipped)}
                        aria-pressed={isFlipped}
                        aria-label="Flip flashcard"
                    >
                        <div className={`relative w-full h-full duration-500 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>

                            {/* FRONT */}
                            <div className="absolute w-full h-full backface-hidden glass-card rounded-3xl border border-slate-700 p-10 flex flex-col items-center justify-center text-center shadow-2xl hover:border-sci-accent transition-colors">
                                <span className="absolute top-8 left-8 text-xs font-bold text-sci-accent uppercase tracking-widest bg-sci-accent/10 px-3 py-1 rounded-full">
                                    {TOPICS[currentCard.topic]}
                                </span>
                                <h2 className="text-2xl md:text-3xl font-bold leading-relaxed">{currentCard.q}</h2>
                                <div className="absolute bottom-8 text-slate-500 text-sm flex items-center gap-2 animate-pulse">
                                    <Icon name="mouse-pointer-2" size={16} /> Click or Space to Flip
                                </div>
                            </div>

                            {/* BACK */}
                            <div className="absolute w-full h-full backface-hidden rotate-y-180 bg-slate-800 rounded-3xl border border-sci-secondary p-10 flex flex-col items-center justify-center text-center shadow-2xl">
                                <p className="text-lg md:text-xl leading-relaxed text-slate-200">{currentCard.a}</p>
                            </div>
                        </div>
                    </button>

                    {/* CONTROLS */}
                    <div className={`mt-8 grid grid-cols-1 md:grid-cols-3 gap-6 transition-all duration-300 ${isFlipped ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4 pointer-events-none'}`}>
                        <button type="button" onClick={(e) => {e.stopPropagation(); handleRate(1)}} className="py-4 rounded-xl bg-sci-danger/10 border border-sci-danger text-sci-danger font-bold hover:bg-sci-danger hover:text-white transition-all">
                            Hard (Revisit)
                        </button>
                        <button type="button" onClick={(e) => {e.stopPropagation(); handleRate(3)}} className="py-4 rounded-xl bg-sci-warning/10 border border-sci-warning text-sci-warning font-bold hover:bg-sci-warning hover:text-white transition-all">
                            Good
                        </button>
                        <button type="button" onClick={(e) => {e.stopPropagation(); handleRate(5)}} className="py-4 rounded-xl bg-sci-success/10 border border-sci-success text-sci-success font-bold hover:bg-sci-success hover:text-white transition-all">
                            Easy (+XP)
                        </button>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        function App() {
            const [view, setView] = useState('dashboard');
            const [xp, setXp] = useStickyState(0, 'physio_xp');

            // Level Calc
            const level = Math.floor(Math.sqrt(xp / 100)) + 1;
            const nextLevelXp = Math.pow(level, 2) * 100;
            const progress = ((xp - Math.pow(level-1, 2)*100) / (nextLevelXp - Math.pow(level-1, 2)*100)) * 100;

            const addXP = (amount) => setXp(curr => curr + amount);

            const NavBtn = ({ id, icon, label, desc }) => (
                <button
                    type="button"
                    onClick={() => setView(id)}
                    aria-pressed={view === id}
                    className="group relative overflow-hidden glass-panel p-6 rounded-2xl text-left transition-all duration-300 hover:border-sci-accent hover:-translate-y-1"
                >
                    <div className="relative z-10">
                        <div className="w-12 h-12 rounded-lg bg-slate-800 flex items-center justify-center mb-4 text-sci-accent group-hover:scale-110 transition-transform">
                            <Icon name={icon} />
                        </div>
                        <h3 className="text-xl font-bold text-white mb-1">{label}</h3>
                        <p className="text-sm text-slate-400">{desc}</p>
                    </div>
                    <div className="absolute inset-0 bg-gradient-to-br from-sci-accent/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity" />
                </button>
            );

            return (
                <div className="min-h-screen pb-20">
                    {/* Header */}
                    <nav className="sticky top-0 z-50 backdrop-blur-md bg-slate-950/80 border-b border-white/5">
                        <div className="container mx-auto px-4 h-16 flex items-center justify-between">
                            <button type="button" className="flex items-center gap-3 cursor-pointer" onClick={() => setView('dashboard')}>
                                <div className="w-8 h-8 rounded bg-gradient-to-br from-sci-accent to-sci-secondary flex items-center justify-center font-bold text-slate-900">P</div>
                                <span className="font-bold tracking-tight">PhysioMaster <span className="text-sci-accent">Pro</span></span>
                            </button>

                            {/* XP Bar */}
                            <div className="flex items-center gap-4 bg-slate-900 px-4 py-1.5 rounded-full border border-slate-800" aria-label={`Level ${level} with ${xp} experience points`}>
                                <div className="text-xs font-bold text-slate-400">LVL {level}</div>
                                <div className="w-24 h-1.5 bg-slate-800 rounded-full overflow-hidden" aria-hidden="true">
                                    <div className="h-full bg-gradient-to-r from-sci-accent to-sci-purple" style={{width: `${progress}%`}}></div>
                                </div>
                                <div className="text-xs font-mono text-sci-accent">{xp} XP</div>
                            </div>
                        </div>
                    </nav>

                    <main id="main" className="container mx-auto px-4 pt-8">
                        {view === 'dashboard' && (
                            <div className="animate-slide-up">
                                <header className="mb-12 text-center">
                                    <h1 className="text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-sci-accent to-sci-secondary mb-4">
                                        Master Cellular Physiology
                                    </h1>
                                    <p className="text-slate-400 text-lg max-w-2xl mx-auto">
                                        Advanced simulations, active recall flashcards, and interactive diagrams designed for distinction.
                                    </p>
                                </header>

                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
                                    <NavBtn id="flashcards" icon="brain-circuit" label="Smart Flashcards" desc="Spaced repetition system that adapts to your knowledge gaps." />
                                    <NavBtn id="ghk" icon="sliders" label="GHK Simulator" desc="Model membrane potential by adjusting ion permeability." />
                                    <NavBtn id="ap" icon="activity" label="Action Potential" desc="Interactive graph exploring channel states during firing." />
                                </div>

                                <div className="mt-12 p-8 rounded-3xl bg-slate-900/50 border border-slate-800 max-w-5xl mx-auto text-center">
                                    <h3 className="text-slate-500 text-xs font-bold uppercase tracking-widest mb-6">Learning Statistics</h3>
                                    <div className="grid grid-cols-1 sm:grid-cols-3 divide-y sm:divide-y-0 sm:divide-x divide-slate-800">
                                        <div className="py-4 sm:py-0">
                                            <div className="text-3xl font-bold text-white">{DATA.length}</div>
                                            <div className="text-sm text-slate-500 mt-1">Total Concepts</div>
                                        </div>
                                        <div className="py-4 sm:py-0">
                                            <div className="text-3xl font-bold text-sci-success">{level}</div>
                                            <div className="text-sm text-slate-500 mt-1">Current Rank</div>
                                        </div>
                                        <div className="py-4 sm:py-0">
                                            <div className="text-3xl font-bold text-sci-purple">{(xp / 50).toFixed(0)}</div>
                                            <div className="text-sm text-slate-500 mt-1">Cards Mastered</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'ghk' && (
                            <div className="max-w-4xl mx-auto">
                                <button type="button" onClick={() => setView('dashboard')} className="mb-6 flex items-center gap-2 text-slate-400 hover:text-white transition"><Icon name="arrow-left" size={16}/> Back to Dashboard</button>
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div className="space-y-6">
                                        <div className="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                                            <h2 className="text-2xl font-bold mb-2 text-white">Understanding RMP</h2>
                                            <p className="text-slate-400 leading-relaxed">
                                                The Resting Membrane Potential is determined by the Goldman-Hodgkin-Katz equation.
                                                Because <strong>P<sub>K</sub></strong> is much higher than P<sub>Na</sub> at rest, Vm sits closer to E<sub>K</sub> (-90mV).
                                            </p>
                                        </div>
                                        <div className="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                                            <h2 className="text-xl font-bold mb-2 text-white">Try This:</h2>
                                            <ul className="list-disc list-inside text-slate-400 space-y-2">
                                                <li>Set to <strong>Depolarization</strong> preset to see the effect of Na+ channels opening.</li>
                                                <li>Increase extracellular K+ ([K+] Out) to 8mM to simulate <strong>Hyperkalemia</strong>. Notice Vm depolarizes!</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <GHKSimulator />
                                </div>
                            </div>
                        )}

                        {view === 'ap' && (
                            <div className="max-w-4xl mx-auto">
                                <button type="button" onClick={() => setView('dashboard')} className="mb-6 flex items-center gap-2 text-slate-400 hover:text-white transition"><Icon name="arrow-left" size={16}/> Back to Dashboard</button>
                                <APExplorer />
                            </div>
                        )}

                        {view === 'flashcards' && (
                            <div className="max-w-4xl mx-auto">
                                <button type="button" onClick={() => setView('dashboard')} className="mb-6 flex items-center gap-2 text-slate-400 hover:text-white transition"><Icon name="arrow-left" size={16}/> Back to Dashboard</button>
                                <Flashcards onXP={addXP} />
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
